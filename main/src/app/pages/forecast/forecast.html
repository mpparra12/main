<div class="p-6 space-y-6">
  <h2 class="text-2xl font-bold text-gray-700 mb-4">Forecast Multi-Pozo</h2>
<div class="charts-wrapper">

  <app-hse-tracker class="chart" [currentTheme]="currentTheme"></app-hse-tracker>
<!-- [HSETrackerData]="HSETrackerData$"-->
</div>

  <!-- Tabs -->
  <div class="border-b border-gray-200 mb-4">
    <nav class="-mb-px flex space-x-8">
      <button
        (click)="selectedTab = 'produccion'"
        [class.border-blue-600]="selectedTab === 'produccion'"
        [class.text-blue-600]="selectedTab === 'produccion'"
        class="whitespace-nowrap border-b-2 px-1 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
      >
        Producción
      </button>
      <button
        (click)="selectedTab = 'financiero'"
        [class.border-blue-600]="selectedTab === 'financiero'"
        [class.text-blue-600]="selectedTab === 'financiero'"
        class="whitespace-nowrap border-b-2 px-1 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
      >
        Financiero
      </button>
    </nav>
  </div>

  <!-- TAB PRODUCCIÓN -->
  <div *ngIf="selectedTab === 'produccion'">
    <div class="flex items-center gap-3">
      <label class="text-sm text-gray-600 font-semibold">Seleccionar Pozo:</label>
      <select [(ngModel)]="selectedPozo" (change)="actualizarFiltro()" class="border p-2 rounded-md">
        <option *ngFor="let p of pozos" [value]="p">{{ p }}</option>
      </select>
      <button (click)="exportarExcel()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-md">
        Exportar Excel
      </button>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
      <div class="bg-blue-100 p-4 rounded-xl text-center">
        <h3 class="text-gray-700 text-sm">Producción Promedio</h3>
        <p class="text-2xl font-bold text-blue-700">{{ getProduccionPromedio() | number:'1.0-0' }}</p>
      </div>
      <div class="bg-green-100 p-4 rounded-xl text-center">
        <h3 class="text-gray-700 text-sm">Forecast Promedio</h3>
        <p class="text-2xl font-bold text-green-700">{{ getPronosticoPromedio() | number:'1.0-0' }}</p>
      </div>
      <div class="bg-yellow-100 p-4 rounded-xl text-center">
        <h3 class="text-gray-700 text-sm">Variación %</h3>
        <p class="text-2xl font-bold text-yellow-700">{{ getVariacion() | number:'1.1-1' }}%</p>
      </div>
    </div>

    <div *ngIf="chartOptions.series && chartOptions.series.length > 0">
      <apx-chart
        #chart
        [series]="chartOptions.series!"
        [chart]="chartOptions.chart!"
        [xaxis]="chartOptions.xaxis!"
        [stroke]="chartOptions.stroke!"
        [tooltip]="chartOptions.tooltip!"
        [dataLabels]="chartOptions.dataLabels!"
        [yaxis]="chartOptions.yaxis!"
        [fill]="chartOptions.fill!">
      </apx-chart>
    </div>
  </div>

  <!-- TAB FINANCIERO -->
  <div *ngIf="selectedTab === 'financiero'">
    <div class="flex items-center gap-3">
      <label class="text-sm text-gray-600 font-semibold">Seleccionar Pozo:</label>
      <select [(ngModel)]="selectedPozoFin" (change)="actualizarFiltroFinanciero()" class="border p-2 rounded-md">
        <option *ngFor="let p of pozosFinancieros" [value]="p">{{ p }}</option>
      </select>
      <button (click)="exportarExcelFinanciero()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-md">
        Exportar Excel
      </button>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
      <div class="bg-blue-100 p-4 rounded-xl text-center">
        <h3 class="text-gray-700 text-sm">Ingresos Promedio</h3>
        <p class="text-2xl font-bold text-blue-700">{{ getIngresoPromedio() | currency }}</p>
      </div>
      <div class="bg-green-100 p-4 rounded-xl text-center">
        <h3 class="text-gray-700 text-sm">Costo Promedio</h3>
        <p class="text-2xl font-bold text-green-700">{{ getCostoPromedio() | currency }}</p>
      </div>
      <div class="bg-yellow-100 p-4 rounded-xl text-center">
        <h3 class="text-gray-700 text-sm">Margen Promedio</h3>
        <p class="text-2xl font-bold text-yellow-700">{{ getMargenPromedio() | number:'1.1-1' }}%</p>
      </div>
    </div>

    <div *ngIf="chartFinOptions.series && chartFinOptions.series.length > 0" class="mt-4">
      <apx-chart
        #chartFin
        [series]="chartFinOptions.series!"
        [chart]="chartFinOptions.chart!"
        [xaxis]="chartFinOptions.xaxis!"
        [stroke]="chartFinOptions.stroke!"
        [tooltip]="chartFinOptions.tooltip!"
        [dataLabels]="chartFinOptions.dataLabels!"
        [yaxis]="chartFinOptions.yaxis!"
        [fill]="chartFinOptions.fill!">
      </apx-chart>
    </div>

    <!-- Tabla Financiera -->
    <div class="mt-6">
      <table mat-table [dataSource]="dataSourceFin" class="mat-elevation-z2 w-full">

        <ng-container matColumnDef="fecha">
          <th mat-header-cell *matHeaderCellDef> Fecha </th>
          <td mat-cell *matCellDef="let element"> {{ element.fecha }} </td>
        </ng-container>

        <ng-container matColumnDef="ingreso">
          <th mat-header-cell *matHeaderCellDef> Ingreso ($) </th>
          <td mat-cell *matCellDef="let element"> {{ element.ingreso | currency }} </td>
        </ng-container>

        <ng-container matColumnDef="capex">
          <th mat-header-cell *matHeaderCellDef> CAPEX ($) </th>
          <td mat-cell *matCellDef="let element"> {{ element.capex | currency }} </td>
        </ng-container>

        <ng-container matColumnDef="opex">
          <th mat-header-cell *matHeaderCellDef> OPEX ($) </th>
          <td mat-cell *matCellDef="let element"> {{ element.opex | currency }} </td>
        </ng-container>

        <ng-container matColumnDef="margen">
          <th mat-header-cell *matHeaderCellDef> Margen (%) </th>
          <td mat-cell *matCellDef="let element"> {{ element.margen | number:'1.1-1' }}% </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsFin"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsFin;"></tr>
      </table>
    </div>
  </div>
</div>
